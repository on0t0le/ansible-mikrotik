- hosts: mikrotik
  gather_facts: false

  tasks:
  - name: add group
    routeros_command:
      commands: 
        - /user group add name=ssh

  - name: add group
    routeros_command:
      commands: 
        - /user group add name=ssh
     
  - name: set group policy
    routeros_command:
      commands: 
        - /user group set ssh policy=!local,ssh,read,write,!telnet,!ftp,!reboot,!policy,!test,!winbox,!password,!web,!sniff,!sensitive,!api,!romon,!dude,!tikapp

  - name: add user
    routeros_command:
      commands: 
        - /user add name=onotole password=password1 group=ssh  
  
  - name: alow ssh key and password
    routeros_command:
      commands: 
        - /ip ssh set always-allow-password-login=yes

  - name: copy pub key
    command: "sshpass -p {{ ansible_ssh_pass }} scp -P {{ ansible_port }} keys/mikrotik.pub {{ ansible_user }}@{{ ansible_host }}:onotole.pub"

  - name: add ssh-key for user
    routeros_command:
      commands: 
        - /user ssh-keys import public-key-file=onotole.pub user=onotole